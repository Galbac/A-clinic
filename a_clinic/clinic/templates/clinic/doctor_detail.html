{% extends "a_clinic/base.html" %}
{% load static %}

{% block title %}{{ doctor.name }}{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="card border-0 shadow-lg">
        <div class="row g-0">
            <!-- –õ–µ–≤–∞—è —á–∞—Å—Ç—å -->
            <div class="col-lg-4 p-4 d-flex flex-column align-items-center">
                <div class="w-100" style="max-width: 300px;">
                    {% if doctor.photo %}
                        <img src="{{ doctor.photo.url }}" alt="{{ doctor.name }}"
                             class="img-fluid rounded"
                             style="width: 100%; height: auto; max-height: 400px; object-fit: contain;">
                    {% else %}
                        <img src="{% static 'img/default_user.png' %}" alt="–§–æ—Ç–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç"
                             class="img-fluid rounded"
                             style="width: 100%; height: auto; max-height: 400px; object-fit: contain;">
                    {% endif %}
                </div>

                {% if doctor.video_presentation %}
                <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ -->
                <button type="button" class="btn btn-outline-secondary w-100 mt-3" data-bs-toggle="modal"
                        data-bs-target="#videoModal">
                    üé• –í–∏–¥–µ–æ-–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è
                </button>

                <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
                <div class="modal fade" id="videoModal" tabindex="-1" aria-labelledby="videoModalLabel"
                     aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="videoModalLabel">–í–∏–¥–µ–æ-–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è –≤—Ä–∞—á–∞</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
                            </div>
                            <div class="modal-body p-0">
                                <div class="ratio ratio-16x9">
                                    {% with video_id=doctor.video_presentation|cut:"https://www.youtube.com/watch?v="|cut:"https://youtu.be/"|cut:"&" %}
                                        <iframe src="https://www.youtube.com/embed/{{ video_id }}"
                                                title="–í–∏–¥–µ–æ-–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è" allowfullscreen></iframe>
                                    {% endwith %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}

                {% if doctor.appointments_url %}
                <a href="{% url 'appointment' slug=doctor.slug %}" class="btn btn-success w-100 mt-2">
                    üóìÔ∏è –ó–∞–ø–∏—Å–∞—Ç—å—Å—è
                </a>
                {% endif %}
                <div class="text-center mt-3">
                    <a href="{% url 'testimonials_doctor' slug=doctor.slug %}" class="btn btn-outline-primary">
                        <i class="bi bi-chat-left-text"></i> –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ—Ç–∑—ã–≤—ã
                    </a>
                </div>
            </div>

            <!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å -->
            <div class="col-lg-8 p-4">
                <h2 class="fw-bold">{{ doctor.name }}</h2>
                <h5 class="text-primary">{{ doctor.department.name }}</h5>

                <div class="row mt-3">
                    <div class="col-sm-6">
                        <p><strong>–°—Ç–∞–∂:</strong>
                            {{ doctor.experience_years|default:"–ù–µ —É–∫–∞–∑–∞–Ω–æ" }} –ª–µ—Ç</p>
                        <p><strong>–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ:</strong>
                            {{ doctor.education|default:"–ù–µ —É–∫–∞–∑–∞–Ω–æ" }}</p>
                        <p><strong>–†–∞–±–æ—á–∏–µ –¥–Ω–∏:</strong><br>
                            {{ doctor.working_days|linebreaks|default:"–ù–µ —É–∫–∞–∑–∞–Ω–æ" }}</p>
                        <p><strong>–ß–∞—Å—ã:</strong><br>
                            {{ doctor.working_hours|linebreaks|default:"–ù–µ —É–∫–∞–∑–∞–Ω–æ" }}</p>
                    </div>
                    <div class="col-sm-6">
                        <p><strong>–ü–æ–ª:</strong> {{ doctor.get_gender_display|default:"–ù–µ —É–∫–∞–∑–∞–Ω–æ" }}</p>
                        <p><strong>–û–Ω–ª–∞–π–Ω-–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏:</strong> {{ doctor.accepts_online|yesno:"–î–∞,–ù–µ—Ç" }}</p>
                        <p><strong>–¶–µ–Ω–∞ –∑–∞ –ø—Ä–∏—ë–º:</strong>
                            {{ doctor.price_per_consultation|default:"–ù–µ —É–∫–∞–∑–∞–Ω–æ" }} ‚ÇΩ</p>
                        <p><strong>–°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –ø–æ –æ—Ç–∑—ã–≤–∞–º:</strong>
                            {% if average_rating %}{{ average_rating }} ‚≠ê{% else %}–ù–µ—Ç –æ—Ç–∑—ã–≤–æ–≤{% endif %}
                        </p>
                        <p><strong>SEO –æ–ø–∏—Å–∞–Ω–∏–µ:</strong> {{ doctor.seo_description|default:"–ù–µ —É–∫–∞–∑–∞–Ω–æ" }}</p>
                    </div>
                </div>

                {% if doctor.bio %}
                <div class="mt-4">
                    <h5>üìò –ë–∏–æ–≥—Ä–∞—Ñ–∏—è</h5>
                    <p class="text-muted">{{ doctor.bio|linebreaks }}</p>
                </div>
                {% endif %}

                {% if doctor.special_services %}
                <div class="mt-4">
                    <h5>üíº –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏</h5>
                    <p class="text-muted">{{ doctor.special_services|linebreaks }}</p>
                </div>
                {% endif %}

                {% if doctor.social_links %}
                <div class="mt-4">
                    <h5>üì± –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏</h5>
                    <div class="d-flex gap-3 fs-4">
                        {% if doctor.social_links.telegram %}
                        <a href="{{ doctor.social_links.telegram }}" class="text-primary" target="_blank">
                            <i class="bi bi-telegram"></i>
                        </a>
                        {% endif %}
                        {% if doctor.social_links.instagram %}
                        <a href="{{ doctor.social_links.instagram }}" class="text-danger" target="_blank">
                            <i class="bi bi-instagram"></i>
                        </a>
                        {% endif %}
                        {% if doctor.social_links.whatsapp %}
                        <a href="{{ doctor.social_links.whatsapp }}" class="text-success" target="_blank">
                            <i class="bi bi-whatsapp"></i>
                        </a>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
